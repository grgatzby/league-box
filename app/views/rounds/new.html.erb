<!-- admin/referee: create new next round. Accessed from Box index view -->
<div class="container">
  <div data-controller="popover" data-bs-html="true" data-bs-toggle="popover"
      data-bs-trigger="hover" data-bs-placement="right" data-bs-delay= '{ "show": 500 }'
      title="Box moves" data-bs-content="<%= t '.message' %>">
    <h3><%= t '.new_round_title' %></h3>
  </div>
  <% if @new_round %>
    <h4><%= @current_round.club.name %></h4>
    <%= form_for @new_round do |f| %>
      <div data-controller="popover" data-bs-html="true" data-bs-toggle="popover"
        data-bs-trigger="hover" data-bs-placement="right" data-bs-delay= '{ "show": 500 }'
        title="Box moves" data-bs-content="<%= t '.message_boxes' %>">
        <div class="boxes">

          <%= f.fields_for :boxes do |new_box| %>
            <% box = @boxes[new_box.index] %>
            <div class="box small-font">
              <div class="box-title"><b><%= "Box #{box.box_number}" %></b></div>
              <ol type="1">
                <% user_box_scores = box.user_box_scores.sort { |a, b| a.rank <=> b.rank } %>
                <%= new_box.fields_for :user_box_scores do |new_user_box_score| %>
                  <% user_box_score = user_box_scores[new_user_box_score.index] %>
                  <li><div class="row">
                    <div class="col-6"><%= render "shared/fullname", user: user_box_score.user %></div>
                    <div class="col-2"><%= "##{user_box_score.rank}" %></div>
                    <div class="col-1"><%= "#{user_box_score.matches_played}" %></div>
                    <div class="col-2"><%= new_user_box_score.select :box_id, [-3,-2,-1,0,1,2,3,99].reverse, selected: @player_moves.shift %></div>
                    <!-- shift is an array method: removes first element from array and returns the element -->
                  </div></li>
                <% end %>
              </ol>
            </div>
          <% end %>

          <div class="new_round-box small-font">
            <div class="box-title"><b><%= "New round" %></b></div>
            <br><br><%= t '.start_date' %>
            <%= f.date_field(:start_date, min: @current_round.end_date + 1, value: @current_round.end_date + 1 ) %>
            <% duration = ((@current_round.end_date + 1 - @current_round.start_date).to_f / 365 * 12).round %>
            <br><%= t '.end_date' %>
            <%= f.date_field(:end_date, min: @current_round.end_date >> 1, value: @current_round.end_date >> duration ) %>
            <%= hidden_field_tag(:club_id, @current_round.club_id) %>
            <div class="buttons-wrap">
              <div class="box-title"><%= f.submit t(".create_round_btn"), class: "btn buttons-shape btn-green" %></div>
              &nbsp;&nbsp;&nbsp;&nbsp;
              <%= link_to "Back", :back, class: "btn buttons-shape btn-yellow" %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
