<%= form_with model: gallery_image, multipart: true, local: true do |f| %>
  <% if gallery_image.errors.any? %>
    <div id="error_explanation" class="bg-rose-200 pt-3 pb-1 mb-4 px-4 rounded-md">
      <div class="bold-font text-rose-700 text-sm pb-4">
        <%= pluralize(gallery_image.errors.size, "error") %> prohibited this image from being saved:
      </div>
      <ul class="pb-0 mb-0">
        <% gallery_image.errors.each do |error| %>
          <li class="text-rose-600 pl-4 text-sm"><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= f.label :image, t("gallery_images._form.image_label"), class: "form-label" %>
    <%= f.file_field :image, accept: "image/jpeg,image/jpg,image/png,image/gif,image/webp", class: "form-control", required: gallery_image.image.blank? %>
    <% if gallery_image.image.present? %>
      <br>
      <small class="form-text text-muted"><%= t("gallery_images._form.current_image") %></small><br>
      <%= image_tag gallery_image.image.url, class: "rounded", style: "max-width: 300px; max-height: 300px;" %>
    <% end %>
  </div>

  <div class="mb-3">
    <%= f.label :caption, t("gallery_images._form.caption_label"), class: "form-label" %>
    <%= f.text_area :caption, class: "form-control", rows: 3, required: true, placeholder: t("gallery_images._form.caption_placeholder") %>
  </div>

  <% if current_user == @admin %>
    <div class="mb-3">
      <%= f.label :club_id, t("gallery_images._form.club_label"), class: "form-label" %>
      <%= f.select :club_id,
          options_for_select(@clubs.map { |club| [club == @sample_club ? t("gallery_images.index.admin_album") : club.name, club.id] }, gallery_image.club_id),
          { prompt: t("gallery_images._form.select_club") },
          { class: "form-control", required: true } %>
      <small class="form-text text-muted"><%= t("gallery_images._form.club_help") %></small>
    </div>
  <% else %>
    <%= f.hidden_field :club_id, value: current_user&.club_id %>
  <% end %>

  <div class="mb-3">
    <%= f.label :accessible_club_ids, t("gallery_images._form.accessible_clubs_label"), class: "form-label" %>
    <% if @clubs.any? %>
      <% @clubs.each do |club| %>
        <div class="form-check">
          <%= check_box_tag "gallery_image[accessible_club_ids][]", club.id, gallery_image.accessible_club_ids.include?(club.id), class: "form-check-input", id: "gallery_image_accessible_club_ids_#{club.id}" %>
          <%= label_tag "gallery_image_accessible_club_ids_#{club.id}", club == @sample_club ? t("gallery_images.index.admin_album") : club.name, class: "form-check-label" %>
        </div>
      <% end %>
      <%= hidden_field_tag "gallery_image[accessible_club_ids][]", "" %>
    <% else %>
      <p class="text-muted"><%= t("gallery_images._form.no_clubs_available") %></p>
    <% end %>
    <small class="form-text text-muted"><%= t("gallery_images._form.accessible_clubs_help") %></small>
  </div>

  <div class="buttons-wrap">
    <%= f.submit gallery_image.persisted? ? t("gallery_images._form.update") : t("gallery_images._form.submit"), class: "btn btn-shape btn-aqua text-size" %>
  </div>
<% end %>
