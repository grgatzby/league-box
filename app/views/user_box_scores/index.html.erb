<%#
  User Box Scores Index Page - Round Ranking Table
  Displays the league table for a specific round showing all players ranked by points.
  Shows player stats: rank, points, box number, matches, sets, and games.
  Allows sorting by clicking column headers and exporting to text/CSV.
%>
<div class="<%= class_names("container": !@is_mobile, "px-2 px-md-3": @is_mobile) %>" data-controller="toggle"
     data-toggle-screen-type-value="<%= @is_mobile ? "mobile" : "widescreen" %>">
  <% if !@is_mobile %><br><% end %>

  <%# Page Title Section %>
  <div class="<%= class_names("one-liner": !@is_mobile, "d-flex flex-column": @is_mobile) %> text-size">
    <h3 class="<%= class_names("mb-0": !@is_mobile, "mb-2 text-center": @is_mobile) %>">
      <%= t('.round_league_table_title', round_nb:  @round_nb ) %>
    </h3>
    <%# Print Header: Logo, copyright, and timestamp (only visible when printing) %>
    <span class="will-print one-liner">
      <div><%= image_tag "box_league_racket.png", alt: "Tennis racket", width: 50 %></div>
      <div>LeagueBox Â©</div>
      <div><%= "#{l(Time.now, format: :wwwddmmm_date)}" %>&nbsp;&nbsp;<%= "#{l(Time.now, format: :hhmm_time)}" %></div>
    </span>
  </div>

  <%# Main Content: Round Selected %>
  <% if @round %>
    <%# Navigation and Action Buttons Section %>
    <div class="<%= class_names("one-liner": !@is_mobile, "d-flex flex-column gap-2": @is_mobile) %>">
      <%# Club and Round Selection Dropdowns %>
      <div class="<%= class_names("d-flex flex-column flex-sm-row gap-2 gap-sm-3 align-items-start": @is_mobile) %>">
        <%= render "shared/select_club", fallback_path: user_box_scores_path %>
        <%= render "shared/select_round", fallback_path: user_box_scores_path %>
      </div>
      <%# Action Buttons: Export to text/CSV, view all boxes, select league %>
      <div class="<%= class_names("": !@is_mobile, "mt-2": @is_mobile) %>">
        <%= render 'action_buttons', round: @round, from: "index" %>
      </div>
    </div>

    <%# Top Line Section: Rules and instructions (hidden when exporting to text) %>
    <% if !@render_to_text %>
      <%= render 'top_line', round: @round, is_mobile: @is_mobile %>
    <% end %>

    <%# League Table: Round ranking with sortable columns %>
    <%= render 'league_table', from: "index" %>
  </div>

  <%# No Round Selected: Display selection forms %>
  <% else %>
    <div class="dont-print text-size">
      <%= render "shared/select_club_round", fallback_path: user_box_scores_path, explain_paragraph: t(".intro") %>
    </div>
  <% end %>
</div>
