<!-- player page to view own match results, enter new scores -->
<div class="container text-size">
  <div>
    <h3><%= t '.my_box_results' %></h3>
    <% if @box %>
      <% @round = @box.round %>
    <% else %>
      <%= render "shared/select_club_round", fallback_path: my_box_path, intro_paragraph: t(".intro") %>
    <% end %>
  </div>
  <% if @round %>
    <%= render "shared/display_club_round", round: @box.round %>
    <% if @user_not_in_round %>
      <br><br><h4><%= render "shared/fullname", user: @current_player %><%= t '.not_in_round' %></h4>
    <% else %>
      <div class="same-line">
        <div><h4><%= render "shared/fullname", user: @current_player %><%= " - box #{@box.box_number}" %></h4></div>
        <div>
          <!-- Back -->
          <% if @page_from %>
            <% parameters = "?round_start=#{@box.round.start_date}&club_name=#{@box.round.club.name}" %>
            <%= link_to @page_from+parameters, class: "btn buttons-shape btn-blue" do %>
              <i class="fa-solid fa-left-long"></i>
            <% end %>
          <% else %>
            <%= link_to :back, class: "btn buttons-shape btn-blue" do %>
              <i class="fa-solid fa-left-long"></i>
            <% end %>
          <% end %>
        </div>
      </div>
      <div class="frame-shape players frame-padding text-size">
        <h4><%= t '.view_enter_scores' %></h4>
        <h6>
          <div class="row justify-content-center top-bottom-padding font-bold text-size">
            <div class="col-sm-3"><%= t '.player_header' %></div>
            <div class="col-sm-2"><%= t '.total_points_header' %></div>
            <div class="col-sm-2"><%= t '.played_on_header' %></div>
            <div class="col-sm-2"><%= t '.action_header' %></div>
          </div>
        </h6>
        <% @my_games.each do |my_game| %>
          <% opponent = my_game[0].user %>
          <% match = my_game[1] %>

          <div class="row justify-content-center">
            <div class="col-sm-3 top-bottom-padding">
              <% opponent_name = "#{render "shared/fullname", user: opponent}" %>
              <% message = "📞 #{opponent.phone_number}<br />✉️ #{opponent.email}" %>
              <div class="mb-4" data-controller="popover" data-bs-html="true" data-bs-toggle="popover"
                  data-bs-trigger="hover" data-bs-placement="bottom" data-bs-delay= '{ "show": 500 }'
                  title="<%= opponent_name %>" data-bs-content="<%= message %>">
                <span style=<%=opponent == @current_player ? "color:green" : "" %>>
                  <%# link_to "#{render "shared/fullname", user: opponent}", "", class: "btn button-ghost", :title => message  %>
                  <%= "#{render "shared/fullname", user: opponent}" %>
                </span>
              </div>
            </div>
            <div class="col-sm-2 top-bottom-padding">
                <%= t("pts", count: my_game[0].points) %>
            </div>
            <div class="col-sm-2 top-bottom-padding">
              <% if match && opponent != @current_player %>
                <%= "#{l(match.time, format: :wwwddmmmyy_date)}" %>
              <% end %>
            </div>
            <div class="col-sm-2">
              <% if opponent == @current_player %>
                <%= link_to t(".view_box_results_btn"), box_list_path(@box), class: "btn buttons-shape btn-blue text-size" %>
              <% elsif match %>
                &emsp;&emsp;&emsp;&emsp;&emsp;
                <%= link_to t(".see_match_result_btn"), match_path(:user_id => opponent.id, :match_id => match.id), class: "btn button-ghost text-size" %>
              <% else %>
                &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
                <%= link_to t(".enter_score_btn"), new_match_path(round_id: @round.id, opponent_id: opponent.id), class: "btn button-ghost text-size" %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div><br>
      <div class="frame-shape players frame-padding text-size">
        <h4><%= t '.chat_in_my_box' %></h4>
        <div class="buttons-wrap">
          <%= link_to t(".access_chatroom_btn"), chatroom_path(@chatroom), class: "btn buttons-shape btn-blue text-size" %>
        </div>
      </div>
    <% end %>
    <br>
    <!--
    <div class="buttons-wrap">
      <% if @page_from %>
        <% parameters = "?round_start=#{@box.round.start_date}&club_name=#{@box.round.club.name}" %>
        <%= link_to "Back", @page_from+parameters, class: "btn buttons-shape btn-blue text-size" %>
      <% else %>
        <%# link_to "Back", "javascript:history.back()", class: "btn buttons-shape btn-blue" %>
        <%= link_to "Back", :back, class: "btn buttons-shape btn-blue text-size" %>
        <%= link_to "Back to top", "#", class: "btn buttons-shape btn-blue text-size" %>
      <% end %>
    </div>
    -->
  <% end %>
</div>
