<!-- list of all boxes -->
<div class="container">
  <h3><%= t '.all_box_title' %></h3>
  <div class="dont-print">
    <%= render "shared/select_club_round", fallback_path: boxes_path, intro_paragraph: t(".intro") %>
  </div>
  <% if @round %>
    <div class = "same-line" data-controller="popover" data-bs-html="true" data-bs-toggle="popover"
        data-bs-trigger="hover" data-bs-placement="bottom" data-bs-delay= '{ "show": 500 }'
        data-bs-content="<%= t '.click_box_pop' %>">
      <%= render "shared/display_club_round", round: @round %>
      <%= link_to t('print_btn'), '#', :onclick => 'window.print();return false;', class: "btn buttons-shape btn-green dont-print"%>
    </div>
    <div data-controller="popover" data-bs-html="true" data-bs-toggle="popover"
        data-bs-trigger="hover" data-bs-placement="right" data-bs-delay= '{ "show": 500 }'
        data-bs-content="<%= t '.message_box_pop' %>">
      <div class="boxes expand-to-print box-scroller">
        <% @boxes.each do |box| %>
          <div class="box small-font">
            <div class="box-title"><strong><%= "Box #{box.box_number}" %></strong></div>
            <ol type="1">
              <% scores = box.user_box_scores.sort { |a, b| a.rank <=> b.rank } %>
              <% scores.each do |user_box_score| %>
                <li class=<%=user_box_score.user == current_user ? "color-orange" : ""%>><div class="row">
                  <div class="col-6"><%= render "shared/fullname", user: user_box_score.user %></div>
                  <div class="col-2"><%= "##{user_box_score.rank}" %></div>
                  <div class="col-1 <%=user_box_score.games_played.zero? ? "color-tennis-red" : ""%>"><%= "#{user_box_score.games_played}" %></div>
                  <div class="col-3"><%= t("pts", count: user_box_score.points) %></div>
                </div></li>
                <% if current_user && (current_user.role == "admin" || current_user.role == "referee") %>
                  <%= link_to '', box_referee_path(user_box_score.box, page_from: boxes_path), class: "box-link" %>
                <% else %>
                  <%= link_to '', box_path(user_box_score.box, page_from: boxes_path), class: 'box-link'%>
                <% end %>
              <% end %>
            </ol>
          </div>
        <% end %>
      </div>
    </div>

    <div class="buttons-wrap dont-print">
      <% if current_user && current_user.role == "admin" %>
          <!-- allow referee/admin to create next round up to 15 days before or 300 days after end of last round
          TO DO: add a time related condition here for the button to appear -->
          <%= link_to t(".create_round_btn"), new_round_path(club_id: @round.club_id), class: "btn buttons-shape btn-aqua" %>
      <% elsif current_user && current_user.role == "referee" %>
          <%= link_to t(".request_round_btn"), contact_path(round_id: @round.id), class: "btn buttons-shape btn-aqua" %>
      <% end %>
    </div>
  <% end %>
</div>
