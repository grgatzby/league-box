<div class="d-none d-md-block dont-print"><%= render "shared/image_front" %></div>
<div class="d-block d-md-none"><br></div>

<div data-controller="toggle" class="container-fluid px-2 px-md-3 px-lg-4"
     data-toggle-display-rounds-value="<%= t '.btn_display_gallery' %>"
     data-toggle-hide-rounds-value="<%= t '.btn_hide_gallery' %>">
  <div class="frame-color-shape frame-padding frame-margin-rl text-size dont-print">

    <!-- Rules Header -->
    <header id="rules-header" class="rules-header mb-4 mb-md-5">
      <h1 class="title mb-0">
        <b><%= t(".rules_title").upcase %></b>
      </h1>
    </header>

    <!-- Rules Sections -->
    <div class="rules-sections-container">
      <% rules_sections = [
        { number: 1, icon: "fa-regular fa-circle-check", key: ".general_rules_section", partial: "1_general_rules" },
        { number: 2, icon: "fa-solid fa-calendar", key: ".round_dates_section", partial: "2_round_dates" },
        { number: 3, icon: "fa-solid fa-trophy", key: ".match_rules_section", partial: "3_match_rules" },
        { number: 4, icon: "fa-solid fa-award", key: ".scoring_and_points_section", partial: "4_scoring_and_points" },
        { number: 5, icon: "fa-solid fa-user-group", key: ".ranking_and_promotions_section", partial: "5_ranking_and_promotions" },
        { number: 6, icon: "fa-solid fa-circle-exclamation", key: ".special_circumstances_section", partial: "6_special_circumstances" },
        { number: 7, icon: "fa-solid fa-scale-balanced", key: ".disputes_section", partial: "7_disputes" }
      ]
      rules_sections.reject! { |section| section[:number] == 2 } unless user_signed_in?
      %>

      <% rules_sections.each do |section| %>
        <%= render "rules_section",
            section_number: section[:number],
            icon_class: section[:icon],
            translation_key: section[:key],
            partial_name: section[:partial] %>
      <% end %>
    </div>
  </div>

  <!-- Rules Actions -->
  <div class="rules-actions-section my-4 my-md-5 dont-print">
    <div class="buttons-wrap d-flex flex-row gap-2 justify-content-center align-items-center" style="flex-wrap: nowrap;">
      <button data-action="click->toggle#toggleRules" data-toggle-target="tournamentRules"
        class="btn btn-shape btn-yellow text-size">
        <%= t '.btn_display_gallery' %>
      </button>
      <%= link_to t(".ok"), boxes_path, class: "btn btn-shape btn-aqua text-size" %>
      <span class="d-none" data-toggle-target="togglableButton">
        <%= link_to t('print_btn'), '#', :onclick => 'window.print();return false;', class: "btn btn-shape btn-green text-size"%>
      </span>
    </div>
  </div>

    <div class="d-none frame-color-shape frame-padding frame-margin-rl text-size print-all-content box-scroller"
         data-toggle-target="togglableElement"
         data-controller="gallery-filter">

      <!-- Gallery Header -->
      <header id="gallery-header" class="gallery-header mb-4 mb-md-5">
        <h2 class="title mb-0">
          <b><%= t(".photo_gallery").upcase %></b>
        </h2>
      </header>

      <% if current_user %>
        <div class="mb-3 d-flex gap-2 justify-content-end">
          <%= link_to t(".upload_image"), new_gallery_image_path, class: "btn btn-shape btn-yellow text-size" %>
          <% if @is_admin && @gallery_images_by_club %>
            <%= link_to t(".edit_gallery"), gallery_images_path, class: "btn btn-shape btn-yellow text-size" %>
          <% end %>
        </div>
      <% end %>

      <% if @gallery_images_by_club.present? && @gallery_images_by_club.any? %>
        <%= render "shared/gallery_filter" %>

        <%# Display images grouped by club for all users %>
        <% @gallery_images_by_club.each do |club, gallery_images| %>
          <% next if club.nil? %>
          <%= render "club_gallery_header",
              club: club,
              gallery_images: gallery_images,
              image_count: gallery_images.count %>
        <% end %>
      <% else %>
        <p><%= t(".no_images") %></p>
      <% end %>

      <%# bouton javascript pour scroller au début des règles %>
      <button  data-action="click->toggle#scrollToTop" data-toggle-target="topButton"
        class="btn btn-shape btn-beige top-button d-none"><i class="fa-solid fa-up-long"></i>
      </button>
    </div>
  </div>
</div>
