<% if !@is_mobile %>
  <div class="dont-print"><%= render "shared/image_front" %></div>
<% else %>
  <br>
<% end %>
<div class="<%= class_names("container": !@is_mobile) %>"
     data-controller="toggle"
     data-toggle-display-rounds-value="<%= t 'pages.rules.btn_display_gallery' %>"
     data-toggle-hide-rounds-value="<%= t 'pages.rules.btn_hide_gallery' %>">
  <!-- My Club Header -->
  <header id="my-club-header" class="mb-4 mb-md-5 dont-print">
    <h1 class="title mb-0">
      <b><%= t(".my_club_title", default: "My Club").upcase %></b>
    </h1>
  </header>

  <div class="frame-color-shape frame-padding">
    <%= render "shared/staff", from:"pages" %>
  </div><br>

  <%# Club Logo and Banner Upload Section (for referees) %>
  <% if current_user && (current_user.role&.include?("referee") || current_user == @admin) %>
    <div class="frame-color-shape frame-padding">
      <br><h4><div class="title"><b><%= t(".club_branding_title").upcase %></b></div></h4><br>

      <%= form_with url: update_club_path, method: :patch, multipart: true, local: true do |f| %>
        <% if current_user == @admin && @is_admin %>
          <div class="mb-3">
            <%= f.label :club_id, t(".select_club"), class: "form-label" %>
            <%= f.select :club_id,
                options_for_select(Club.all.reject { |c| c == @sample_club }.map { |club| [club.name, club.id] }, @club.id),
                {},
                { class: "form-control", id: "club_select" } %>
          </div>
        <% else %>
          <%= f.hidden_field :club_id, value: @club.id %>
        <% end %>

        <%= f.fields_for :club, @club do |club_form| %>
          <div class="mb-3">
            <%= club_form.label :logo, t(".logo_label"), class: "form-label" %>
            <%= club_form.file_field :logo, accept: "image/jpeg,image/jpg,image/png,image/gif,image/webp", class: "form-control" %>
            <% if @club.logo.present? %>
              <small class="form-text text-muted"><%= t(".current_logo") %></small><br>
              <%= image_tag @club.logo.url, class: "rounded", style: "max-width: 200px; max-height: 200px; margin-top: 10px;" %>
            <% end %>
          </div>

          <div class="mb-3">
            <%= club_form.label :banner, t(".banner_label"), class: "form-label" %>
            <%= club_form.file_field :banner, accept: "image/jpeg,image/jpg,image/png,image/gif,image/webp", class: "form-control" %>
            <% if @club.banner.present? %>
              <small class="form-text text-muted"><%= t(".current_banner") %></small><br>
              <%= image_tag @club.banner.url, class: "rounded", style: "max-width: 400px; max-height: 200px; margin-top: 10px;" %>
            <% end %>
          </div>
        <% end %>

        <%= f.submit t(".update_branding"), class: "btn btn-shape btn-aqua mb-3" %>
      <% end %>
    </div><br>
  <% end %>

  <%# Player Directory Section %>
  <br><h4><div id="player_directory" class="title"><b><%= t("shared.my_club.player_directory_title").upcase %></b></div></h4><br>
  <% if @is_admin && @players_by_club %>
    <%# Admin view: Grouped by club %>
    <% @players_by_club.each do |club, players| %>
      <% next if club.nil? %>
      <%= render "shared/player_directory", players: players, club_name: club.name, is_mobile: @is_mobile %>
    <% end %>
  <% elsif @players %>
    <%# Regular user view: Single club %>
    <%= render "shared/player_directory", players: @players, club_name: @club.name, is_mobile: @is_mobile %>
  <% end %>

  <%= render "gallery_toggle_buttons",
      toggle_button_class: "btn btn-shape btn-aqua text-size",
      translation_namespace: "pages.rules",
      ok_translation_key: "pages.my_club.ok" %>

  <%= render "embedded_gallery", translation_namespace: "pages.rules" %>
</div>
