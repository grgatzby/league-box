<!-- display (players), or chose and display (admin/referee) a chatroom.
For each box, if not already created in Round/new (TO DO?), or in UserBoxScore/new (TO DO?),
a chatroom is created in Box controller #my_box.
-->
<% if @chatroom %>
  <!-- coming from Box/my_box -->
  <div class="container"
    data-controller="chatroom-subscription"
    data-chatroom-subscription-chatroom-id-value="<%= @chatroom.id %>"
    data-chatroom-subscription-chatroom-name-value="<%= @chatroom.name %>"
  >
    <br><div class="one-liner" style="width: 50%">
      <h3>Chatroom</h3>
      <span class="will-print"><%= image_tag "tennis_racket.png", alt: "Tennis racket", width: 50 %> LeagueBox Â©</span>
    </div>
    <h5  class="one-liner">
      <div><%= render "shared/display_round", round: @chatroom.box.round %></div>
      #<%= t(".chatroom_title", chatroom: @chatroom.name) %>
      <div>
        <%= link_to t('.back_btn'), :back, class: "btn buttons-shape btn-yellow" %>
        <%= link_to t('print_btn'), '#', :onclick => 'window.print();return false;', class: "btn buttons-shape btn-green dont-print"%>
      </div>
    </h5>
    <div class="frame-color-shape chatroom-frame">
        <!-- previous messages -->
      <div class="messages print-all-content" data-chatroom-subscription-target="messages">
        <div data-controller="popover" data-bs-html="true" data-bs-toggle="popover"
          data-bs-trigger="click" data-bs-placement="center" data-bs-delay= '{ "show": 500 }'
          data-bs-content="<%= t '.message' %>">
          <% @chatroom.messages.sort.each do |message| %>
            <%= render "messages/message", message: message %>
          <% end %>
        </div>
      </div>

      <!-- new message form -->
      <div class="dont-print">
        <!--   <%= simple_form_for [@chatroom, @message],
          html: { data: { action: "turbo:submit-end->chatroom-subscription#resetForm" }, class: "d-flex" } do |f| %>
          <%= f.input :content,
            label: false,
            placeholder: "Message ##{@chatroom.name}",
            wrapper_html: {class: "flex-grow-1"}
          %>
          <%= f.submit t(".send_btn"), class: "btn buttons-shape btn-beige ms-2 mb-3" %>
        <% end %> -->
        <%= form_for [@chatroom, @message],
          html: { data: { action: "turbo:submit-end->chatroom-subscription#resetForm" }, class: "d-flex" } do |f| %>
          <%= f.text_field :content,
            label: false,
            placeholder: "Message ##{@chatroom.name}",
            class: "flex-grow-1 border-0 rounded-3"
          %>
          <%= f.submit t(".send_btn"), class: "btn buttons-shape btn-beige ms-2" %>
        <% end %>
      </div>
    </div>
  </div>
<% else %>
  <!-- referees and admin get to select a chatroom -->
  <div class="container">
    <br><h3><%= t(".chatrooms_title", club: current_user == @admin ? "" : current_user.club.name) %></h3>
    <div class="players frame-padding text-size">
      <%= form_with url: chatroom_path, method: :get do |form| %>
        <%= form.label :chatroom, t(".chose_chatroom") %>
        &nbsp;&nbsp;&nbsp;&nbsp;<%= form.select :chatroom, @chatrooms.sort %>
        &nbsp;&nbsp;&nbsp;&nbsp;<%= form.submit t(".confirm_btn"), class: "btn buttons-shape btn-green", name: "" %>
      <% end %>
    </div>
  </div>
<% end %>
<br>
<!--
<div class="buttons-wrap dont-print">
  <%= link_to t(".back_btn"), :back, class: "btn buttons-shape btn-yellow" %>
</div>
-->
