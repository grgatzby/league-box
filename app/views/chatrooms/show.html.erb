<!-- display or chose and display (admin/referee) a chatroom
chatrooms for each box are created in Box controller #my_box,
if not already created in Round/new (TO DO), or in UserBoxScore/new (TO DO)-->
<% if @chatroom %>
<!-- coming from Box/my_box -->
  <div class="container"
    data-controller="chatroom-subscription"
    data-chatroom-subscription-chatroom-id-value="<%= @chatroom.id %>"
    data-chatroom-subscription-chatroom-name-value="<%= @chatroom.name %>"
  >
    <br>
    <h3>
      #<%= t(".chatroom_title", chatroom: @chatroom.name) %>
      <%= link_to t('print'), '#', :onclick => 'window.print();return false;', class: "btn buttons-shape btn-blue dont-print"%>
    </h3>
    <div class="frame-shape chatroom">
        <!-- previous messages -->
      <div class="messages do-expand" data-chatroom-subscription-target="messages">
        <div data-controller="popover" data-bs-html="true" data-bs-toggle="popover" data-bs-trigger="click" data-bs-placement="center" data-bs-content="<%= t '.message' %>">
          <% @chatroom.messages.sort.each do |message| %>
            <%= render "messages/message", message: message %>
          <% end %>
        </div>
      </div>

      <!-- new message form -->
      <div class="dont-print">
        <%= simple_form_for [@chatroom, @message],
          html: { data: { action: "turbo:submit-end->chatroom-subscription#resetForm" }, class: "d-flex" } do |f|
        %>
          <%= f.input :content,
            label: false,
            placeholder: "Message ##{@chatroom.name}",
            wrapper_html: {class: "flex-grow-1"}
          %>
          <%= f.submit t(".send_btn"), class: "btn buttons-shape btn-beige ms-2 mb-3" %>
        <% end %>
      </div>
    </div>
  </div>
<% else %>
  <!-- referees and admin get to select a chatroom -->
  <div class="container">
    <br><h3><%= t(".chatrooms_title", club: current_user.club.name) %></h3>
    <div class="frame-shape players frame-padding text-size">
      <%= form_with url: chatroom_path, method: :get do |form| %>
        <%= form.label :chatroom, t(".chose_chatroom") %>
        &nbsp;&nbsp;&nbsp;&nbsp;<%= form.select :chatroom, @chatrooms.sort %>
        &nbsp;&nbsp;&nbsp;&nbsp;<%= form.submit t(".confirm_btn"), class: "btn buttons-shape btn-green" %>
      <% end %>
    </div>
  </div>
<% end %>
<br>
<!--
<div class="buttons-wrap dont-print">
  <%= link_to t(".back_btn"), :back, class: "btn buttons-shape btn-blue" %>
</div>
-->
